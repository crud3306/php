  
动态语言的并发处理  
  
  
什么是进程、线程、协程   
-----------
进程(process)是计算机中的程序关于某数据集合上的一次运行活动，是系统进行资源分配和调度的基本单位，是操作系统结构的基础。进程是一个"执行中的程序"。  
进程的三态模型：多道程序系统中，进程在处理器上交替运行，状态不断地发生变化。  
三状模型：运行、就绪、阻塞  
  
运行：当一个进程在处理机上运行时，则称该进程处理运行状态。处于此状态的进程的数目小于等于处理器的数目，对于单处理机系统，处于运行状态的进程只有一个。在没有其他进程可以执行时（如所有进程都在阻塞状态），通常会自动执行系统的空闲进程。  
  
就绪：当一个进程获得了除处理机以外的一切所需资源，一量得到处理机即可运行，则称此进程处于就绪状态。就绪进程可以按多个优先级来划分队列。例如：当一个进程由于时间片用完而进入就绪状态时，排入低优先级队列；当进程由i/o操作完成而进入就绪状态时，排入高优先级队列。  
  
阻塞：也称为等待或睡眠状态，一个进程正在等待某一事件发生（例如请求i/o而等待i/o完成等）而暂时停止运行，这时即使把处理机分配给进程也无法运行，故称该进程处理阻塞状态。  
  
另外进程还有一个五态模型  
进程的五态模型：对于一个实际的系统，进程的状态及其转换更为复杂。  
五态模型：新建态、活跃就绪/静止就绪、运行、活跃阻塞/静止阻塞、终止态  
  
新建态：对应于进程刚刚被创建时没有被提交的状态，并等待系统完成创建进程的所有必要信息。  
   
活跃就绪：是指进程在主内存中并且可被调度的状态。   
  
静止就绪（挂起就绪）：是指进程被对换到辅存时的就绪状态，是不能被直接调度的状态，只有当主存中没有活跃就绪态进程，或者是挂起就绪态进程具有更高的优先级，系统将把挂起就绪态进程调回主存并转换为活跃就绪。  
  
活跃阻塞：指进程已在主存，一量等待的事件产生便进入活跃就绪状态。  
  
静止阻塞：进程对换到辅存时的阻塞状态，一量等待的事件产生便进入静止就绪状态。  
    
终止态：进程已结束运行，回收除进程控制块之外的其它资源，并让其他进程从进程控制块中收集有关信息。  
   
由于用户的并发请求，为每个请求都创建一个进程显然是行不通的，从系统资源开销方面或是响应用户请求的效率方面来看。因此操作系统中线程的概念便被引进了。  
线程：有时被称为轻量级进程（lightweight process, 简称lwp），是程序执行流的最小单元。  
  
  
  
  
  
  
线程与进程的区别：  
1 线程是进程内的一个执行单元，进程内至少有一个线程，它们共享进程的地址空间，而进程有自已独立的地址空间  
2 进程是资源分配和拥有的单位，同一个进程内的线程共享进程的资源  
3 线程是处理器调度的基本单位，但进程不是  
4 二者均可并发执行    
5 每个独立的线程有一个程序运行的入口、顺序执行序列和程序的出口，但是线程不能够独立执行，必须存在应用程序中，由应用程序提供多个线程执行控制   
  
  
线程与协程的区别：  
1 一个线程可以有多个协程，一个进程也可以单独拥有多个协程  
2 线程进程都是同步机制，而协程是异步  
3 协程能保留上一次调用时的状态，每次过程重入时，就相当于进入上一次调用的状态  
    
  
  
```php
<?php
$sockserv = stream_socket_server('tcp://0.0.0.0:8000', $errno, $errstr);

for ($i = 0; $i < 5; $i++) {
	$fork_id = pcntl_fork();
	if ($fork_id == -1) {
		exit;
	} elseif ($fork_id == 0) {
		while (true) {
			$conn = stream_socket_accept($sockserv);
			if ($conn == false) {
				continue;
			}
			$request = fread($conn, 2000);
			$response = 'hello';
			fwrite($conn, $response);
			fclose($conn);
		}
		exit(0);
	} else {

	}
}

```
  
  
php的swoole扩展  
































